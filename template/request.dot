const toJsonSchema = require('to-json-schema');
const json_responses = require('{{jsonSchemaPath}}');

class request {
  constructor() {
    // Write your constructor here, if you need
  }

  request({{keyDataDriven1}}, expect) {
    return api.{{method}}("{{endpoint}}")
    .set("accept", "application/json").set("Content-Type", "application/json"){{header}}
    .send(this.body({{keyDataDriven2}}))
    .end(expect)
  }
 
  body({{params}}) {
    // Define desired object
    var obj = {{objectBody}}
    // Return it
    return obj
  }

  expect(cases="success") {
    // options for jsonSchema
    const options = {
      objects: {
        postProcessFnc: (schema, obj, defaultFnc) => ({...defaultFnc(schema, obj), required: Object.getOwnPropertyNames(obj)})
      }
    }
    
    if (json_responses.hasOwnProperty(cases))
    return toJsonSchema(json_responses[cases], options)
  }
}

module.exports = request