const chai = require('chai')
chai.use(require('chai-http'))
const toJsonSchema = require('to-json-schema');
const json_responses = require('{{jsonSchemaPath}}');
const requestHelper = require('../../helper/requestHelper');
require('dotenv').config()
const api = chai.request(process.env.APP_URL);

class request {
  constructor() {
    // Write your constructor here, if you need
  }

  request(...args) {
    return api.{{method}}("{{endpoint}}"){{query}}
    .set("accept", "application/json").set("Content-Type", "application/json"){{header}}{{bodyFunc}}
    .end(new requestHelper().getExpectFunc(args))
  }
 
  body(...args) {
    const waitFor = (ms) => new Promise(r => setTimeout(r, ms))

    // your rawJSON body
    var obj = {{objectBody}}

    if (args.length > 0) {
      new requestHelper().objectMapping(obj, args[0])
    }
    waitFor(100)

    // Return it
    return obj
  }

  expect(cases="success", strCase=cases) {
    if(cases.includes(strCase)) cases = strCase
    if (json_responses.hasOwnProperty(cases)) {
      return toJsonSchema(json_responses[cases], new requestHelper().jsonSchemaOption())
    } else {
      throw new Error('JSON Schema: '+cases+', does not exist!')
    }
  }
}

module.exports = request